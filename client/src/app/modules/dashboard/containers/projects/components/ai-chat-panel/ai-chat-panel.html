<p-toast />

<div class="flex h-full flex-col">
    <div class="-me-4 flex-1 overflow-y-auto pe-4 pb-4" [class.space-y-4]="messages().length > 0">
        @if (isLoading()) {
            <div class="flex items-center justify-center py-4">
                <p-progress-spinner ariaLabel="loading chats" strokeWidth="4" />
            </div>
        } @else {
            @for (message of messages(); track message.id) {
                <app-ai-chat-message [message]="message" />
            } @empty {
                <app-empty-state
                    icon="pi pi-sparkles"
                    title="Start a conversation"
                    subtitle="Ask questions about this item and get AI-powered insights and suggestions."
                />
            }

            @if (isWaitingForAiResponse()) {
                <div class="bg-gray-50 flex items-center gap-2 rounded-lg p-3">
                    <p-progress-spinner ariaLabel="AI is typing" strokeWidth="3" class="h-4 w-4" />
                    <span class="text-sm text-gray-500">AI is typing...</span>
                </div>
            }
        }
    </div>
    <div class="flex gap-2 border-t border-gray-100 pt-3">
        <input
            pInputText
            [(ngModel)]="newMessage"
            (keydown.enter)="sendMessage()"
            placeholder="Ask anything about this..."
            class="flex-1"
            [disabled]="isLoading() || isWaitingForAiResponse()"
        />
        <p-button
            (onClick)="sendMessage()"
            [disabled]="!newMessage().trim() || isLoading() || isWaitingForAiResponse()"
            icon="pi pi-send"
            size="large"
            styleClass="rounded-xl"
        />
    </div>
</div>
